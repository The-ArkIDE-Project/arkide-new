{"version":3,"file":"js/addon-entry-editor-colored-context-menus.js","sources":["webpack://GUI/./src/addons/addons/editor-colored-context-menus/userscript.css","webpack://GUI/./src/addons/addons/editor-colored-context-menus/_runtime_entry.js","webpack://GUI/./src/addons/addons/editor-colored-context-menus/userscript.js"],"sourcesContent":["exports = module.exports = require(\"../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".sa-contextmenu-colored .blocklyContextMenu {\\n  background: var(--sa-contextmenu-bg) !important;\\n  border-color: var(--sa-contextmenu-border) !important;\\n}\\n.sa-contextmenu-colored .blocklyContextMenu .goog-menuitem-highlight,\\n.sa-contextmenu-colored .s3dev-mi:hover {\\n  background-color: #0001;\\n  border-color: transparent !important;\\n}\\n.sa-contextmenu-colored .blocklyContextMenu .goog-menuitem[style*=\\\"border-top\\\"] {\\n  border-top-color: var(--sa-contextmenu-border) !important;\\n}\\n.sa-contextmenu-colored .blocklyContextMenu .goog-menuitem .goog-menuitem-content {\\n  color: var(--sa-contextmenu-text, #fff);\\n}\\n\\n\", \"\"]);\n\n// exports\n","/* generated by pull.js */\nimport _js from \"./userscript.js\";\nimport _css from \"!css-loader!./userscript.css\";\nexport const resources = {\n  \"userscript.js\": _js,\n  \"userscript.css\": _css,\n};\n","import { removeAlpha } from \"../../libraries/common/cs/text-color.esm.js\";\n\nexport default async function ({ addon, console }) {\n  const ScratchBlocks = await addon.tab.traps.getBlockly();\n\n  const fixupColor = (color) => {\n    // some extensions have SVG-gradient styled blocks\n    if (color.startsWith(`url(#`)) {\n      const gradientID = color.substring(5, color.length - 1);\n      const gradientCode = document.querySelector(`svg [id=\"${gradientID}\"]`);\n      if (!gradientCode || gradientCode.tagName !== \"linearGradient\") return \"#000000\";\n\n      const parseCoord = v => parseFloat(v.replace(\"%\", \"\"));\n      const x1 = parseCoord(gradientCode.getAttribute(\"x1\") || \"0\");\n      const y1 = parseCoord(gradientCode.getAttribute(\"y1\") || \"0\");\n      const x2 = parseCoord(gradientCode.getAttribute(\"x2\") || \"100\");\n      const y2 = parseCoord(gradientCode.getAttribute(\"y2\") || \"0\");\n\n      const dx = x2 - x1, dy = y2 - y1;\n      const angleDeg = ((Math.atan2(dy, dx) * 180) / Math.PI + 90 + 360) % 360;\n\n      const stops = Array.from(gradientCode.querySelectorAll(\"stop\")).map(stop => {\n        const color = stop.getAttribute(\"stop-color\") || \"#000\";\n        let offset = stop.getAttribute(\"offset\");\n        if (!offset) offset = \"0%\";\n        else if (!offset.endsWith(\"%\")) offset = parseFloat(offset) * 100 + \"%\";\n        return `${color} ${offset}`;\n      });\n      return `linear-gradient(${angleDeg.toFixed(2)}deg, ${stops.join(\", \")})`;\n    } else {\n      return removeAlpha(color);\n    }\n  };\n\n  const applyContextMenuColor = (block) => {\n    const widgetDiv = ScratchBlocks.WidgetDiv.DIV;\n    if (!widgetDiv) {\n      return;\n    }\n    const background = block.svgPath_;\n    if (!background) {\n      return;\n    }\n    const fill = fixupColor(background.getAttribute(\"fill\"));\n    const border = background.getAttribute(\"stroke\") || \"#0003\";\n    widgetDiv.classList.add(\"sa-contextmenu-colored\");\n    widgetDiv.style.setProperty(\"--sa-contextmenu-bg\", fill);\n    widgetDiv.style.setProperty(\"--sa-contextmenu-border\", border);\n    widgetDiv.style.setProperty(\"--sa-contextmenu-text\", block.textColour ?? \"#fff\");\n  };\n\n  const originalHandleRightClick = ScratchBlocks.Gesture.prototype.handleRightClick;\n  ScratchBlocks.Gesture.prototype.handleRightClick = function (...args) {\n    const block = this.targetBlock_;\n    const ret = originalHandleRightClick.call(this, ...args);\n    if (block) {\n      applyContextMenuColor(block);\n    }\n    return ret;\n  };\n\n  const originalHide = ScratchBlocks.WidgetDiv.hide;\n  ScratchBlocks.WidgetDiv.hide = function (...args) {\n    if (ScratchBlocks.WidgetDiv.DIV) {\n      ScratchBlocks.WidgetDiv.DIV.classList.remove(\"sa-contextmenu-colored\");\n    }\n    return originalHide.call(this, ...args);\n  };\n}\n"],"mappings":";;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACPA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AADA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAHA;AAAA;AAIA;AACA;AACA;;;;A","sourceRoot":""}